{"version":3,"sources":["calendar-input/calendar-input.tsx"],"names":[],"mappings":"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","file":"calendar-input.d.ts","sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/* eslint-disable max-len */\n\nimport React from 'react';\nimport formatDate from 'date-fns/format';\nimport { createCn } from 'bem-react-classname';\nimport { withTheme } from '../cn';\n\nimport Calendar, { CalendarProps } from '../calendar/calendar';\nimport IconCalendar from '../icon/entity/calendar';\nimport IconButton from '../icon-button/icon-button';\nimport Input from '../input/input';\nimport Mq from '../mq/mq';\nimport Popup from '../popup/popup';\nimport PopupHeader from '../popup-header/popup-header';\n\nimport keyboardCode from '../lib/keyboard-code';\nimport { isNodeOutsideElement } from '../lib/window';\nimport {\n    parseDate, calculateMonth, changeDateFormat, isInputDateSupported,\n} from './utils';\nimport performance from '../performance';\n\n/**\n * NB: В нативном календаре нельзя менять формат даты. Приемлем только YYYY-MM-DD формат.\n * https://www.w3.org/TR/html-markup/input.date.html#input.date.attrs.value\n * https://tools.ietf.org/html/rfc3339#section-5.6\n*/\nconst CUSTOM_DATE_FORMAT = 'DD.MM.YYYY';\nconst NATIVE_DATE_FORMAT = 'YYYY-MM-DD';\nconst IS_BROWSER = typeof window !== 'undefined';\nconst SUPPORTS_INPUT_TYPE_DATE = IS_BROWSER && isInputDateSupported();\n\nexport type CalendarInputProps = {\n\n    /**\n     * Содержимое поля ввода\n     */\n    value?: string;\n\n    /**\n     * Содержимое поля ввода, указанное по умолчанию\n     */\n    defaultValue?: string;\n\n    /**\n     * Дата для отображения календаря по умолчанию\n     */\n    defaultMonth?: string | number | any;\n\n    /**\n     * Свойства компонента [Calendar](#!/Calendar)\n     */\n    calendar?: CalendarProps;\n\n    /**\n     * Управление возможностью раскрытия календаря\n     */\n    opened?: boolean;\n\n    /**\n     * Тип инпута (filled только на белом фоне в размере m)\n     */\n    view?: 'default' | 'filled';\n\n    /**\n     * Управление возможностью компонента занимать всю ширину родителя\n     */\n    width?: 'default' | 'available';\n\n    /**\n     * Направления, в которые может открываться попап компонента\n     */\n    directions?: ReadonlyArray<'anchor' | 'top-left' | 'top-center' | 'top-right' | 'left-top' | 'left-center' | 'left-bottom' | 'right-top' | 'right-center' | 'right-bottom' | 'bottom-left' | 'bottom-center' | 'bottom-right'>;\n\n    /**\n     * Управление автозаполнением компонента\n     */\n    autocomplete?: boolean;\n\n    /**\n     * Управление возможностью изменения значения компонента\n     */\n    disabled?: boolean;\n\n    /**\n     * Размер компонента\n     */\n    size?: 's' | 'm' | 'l' | 'xl';\n\n    /**\n     * Последовательность перехода между контролами при нажатии на Tab\n     */\n    tabIndex?: number;\n\n    /**\n     * Добавление дополнительных элементов к инпуту слева\n     */\n    leftAddons?: React.ReactNode;\n\n    /**\n     * Добавление дополнительных элементов к инпуту справа\n     */\n    rightAddons?: React.ReactNode;\n\n    /**\n     * Управление рендером иконки календаря в инпуте\n     */\n    withIcon?: boolean;\n\n    /**\n     * Лейбл для поля\n     */\n    label?: React.ReactNode;\n\n    /**\n     * Подсказка в поле\n     */\n    placeholder?: string;\n\n    /**\n     * Подсказка под полем\n     */\n    hint?: React.ReactNode;\n\n    /**\n     * Отображение ошибки\n     */\n    error?: React.ReactNode;\n\n    /**\n     * Сброс ошибки при установке фокуса в компоненте Input\n     */\n    resetError?: boolean;\n\n    /**\n     * Управление нативным режимом на мобильных устройствах\n     */\n    mobileMode?: 'native' | 'popup' | 'input';\n\n    /**\n     * Подсказка над меню в мобильном режиме\n     */\n    mobileTitle?: React.ReactNode;\n\n    /**\n     * Идентификатор компонента в DOM\n     */\n    id?: string;\n\n    /**\n     * Имя компонента в DOM\n     */\n    name?: string;\n\n    /**\n     * Дополнительный класс\n     */\n    className?: string;\n\n    /**\n     * Тема компонента\n     */\n    theme?: 'alfa-on-color' | 'alfa-on-white';\n\n    /**\n     * Обработчик установки фокуса на компонент\n     */\n    onFocus?: (event?: React.FocusEvent<any>) => void;\n\n    /**\n     * Обработчик снятия фокуса с компонента\n     */\n    onBlur?: (event?: React.FocusEvent<any>) => void;\n\n    /**\n     * Обработчик установки фокуса на поле ввода\n     */\n    onInputFocus?: (event?: React.FocusEvent<any>) => void;\n\n    /**\n     * Обработчик снятия фокуса с поля ввода\n     */\n    onInputBlur?: (event?: React.FocusEvent<any>) => void;\n\n    /**\n     * Обработчик ввода даты в текстовом поле\n     */\n    onInputChange?: (value?: string) => void;\n\n    /**\n     * Обработчик выбора даты в календаре\n     */\n    onCalendarChange?: (formattedValue?: string) => void;\n\n    /**\n     * Обрабочик изменения даты в календаре\n     */\n    onChange?: (formattedValue?: string, value?: number) => void;\n\n    /**\n     * Обработчик события нажатия на клавишу в момент, когда фокус находится на компоненте\n     */\n    onKeyDown?: (event?: React.KeyboardEvent<any>) => void;\n\n    /**\n     * Обработчик события нажатия на клавишу клавиатуры в момент, когда фокус находится в календаре\n     */\n    onCalendarKeyDown?: (event?: React.KeyboardEvent<any>) => void;\n\n    /**\n     * Обработчик события нажатия на клавишу клавиатуры в момент, когда фокус находится на текстовом поле\n     */\n    onInputKeyDown?: (event?: React.KeyboardEvent<any>) => void;\n\n    /**\n     * Идентификатор для систем автоматизированного тестирования\n     */\n    'data-test-id'?: string;\n};\n\n/**\n * Компонент для ввода даты.\n */\n@performance(true)\nexport class CalendarInput extends React.Component<CalendarInputProps> {\n    protected cn = createCn('calendar-input');\n\n    static defaultProps: Partial<CalendarInputProps> = {\n        withIcon: true,\n        directions: ['bottom-left', 'bottom-right', 'top-left', 'top-right'],\n        placeholder: '00.00.0000',\n        mobileMode: 'native',\n    };\n\n    state = {\n        isMobile: false,\n        isInputFocused: false,\n        isCalendarFocused: false,\n        opened: false,\n        value: this.props.defaultValue || '',\n        month: calculateMonth(\n            this.props.value || this.props.defaultMonth,\n            CUSTOM_DATE_FORMAT,\n            this.props.calendar ? this.props.calendar.earlierLimit : undefined,\n            this.props.calendar ? this.props.calendar.laterLimit : undefined,\n        ),\n    };\n\n    private timeoutId;\n\n    private changeCloseTimeoutId;\n\n    /**\n     * @type {Calendar}\n     */\n    private calendar;\n\n    /**\n     * @type {Popup}\n     */\n    private calendarPopup;\n\n    /**\n     * @type {Input}\n     */\n    private customCalendarTarget;\n\n    private nativeCalendarTarget;\n\n    componentDidMount() {\n        if (this.calendarPopup) {\n            let element;\n\n            if (this.nativeCalendarTarget) {\n                element = this.nativeCalendarTarget;\n            } else if (this.customCalendarTarget) {\n                element = this.customCalendarTarget.getBoxNode();\n            }\n\n            if (element) {\n                this.calendarPopup.setTarget(element);\n            }\n        }\n    }\n\n    componentWillUnmount() {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n            this.timeoutId = null;\n        }\n        if (this.changeCloseTimeoutId) {\n            clearTimeout(this.changeCloseTimeoutId);\n            this.changeCloseTimeoutId = null;\n        }\n    }\n\n    render() {\n        const value = this.props.value === undefined ? this.state.value : this.props.value;\n\n        const commonProps = {\n            disabled: this.props.disabled,\n            tabIndex: this.props.tabIndex,\n            formNoValidate: true,\n        };\n\n        const nativeProps = {\n            min: this.props.calendar\n                && this.props.calendar.earlierLimit\n                && formatDate(this.props.calendar.earlierLimit, NATIVE_DATE_FORMAT),\n            max: this.props.calendar\n                && this.props.calendar.laterLimit\n                && formatDate(this.props.calendar.laterLimit, NATIVE_DATE_FORMAT),\n        };\n\n        const wrapperProps = this.isMobilePopup() && !this.props.disabled\n            ? {\n                role: 'button',\n                tabIndex: 0,\n                onClick: this.handleMobileWrapperClick,\n            }\n            : {};\n\n        return (\n            <span\n                className={ this.cn({ width: this.props.width }) }\n                data-test-id={ this.props['data-test-id'] }\n            >\n                <span\n                    { ...wrapperProps }\n                >\n                    <Mq\n                        query=\"--small-only\"\n                        touch={ true }\n                        onMatchChange={ this.handleMqMatchChange }\n                    >\n                        {\n                            this.canBeNative()\n                            && (\n                                <input\n                                    ref={ (nativeCalendarTarget) => {\n                                        this.nativeCalendarTarget = nativeCalendarTarget;\n                                    } }\n                                    { ...commonProps }\n                                    { ...nativeProps }\n                                    className={ this.cn('native-control') }\n                                    type=\"date\"\n                                    value={ changeDateFormat(value, CUSTOM_DATE_FORMAT, NATIVE_DATE_FORMAT) }\n                                    onBlur={ this.handleNativeInputBlur }\n                                    onChange={ this.handleNativeInputChange }\n                                    onFocus={ this.handleNativeInputFocus }\n                                />\n                            )\n                        }\n                    </Mq>\n                    <Input\n                        ref={ (customCalendarTarget) => {\n                            this.customCalendarTarget = customCalendarTarget;\n                        } }\n                        { ...commonProps }\n                        autocomplete={ this.props.autocomplete }\n                        className={ this.cn('custom-control') }\n                        disabledAttr={ this.isNativeInput() || this.isMobilePopup() }\n                        focused={ this.state.isInputFocused || this.state.isCalendarFocused }\n                        mask=\"11.11.1111\"\n                        size={ this.props.size }\n                        type=\"tel\"\n                        pattern=\"[0-9.]*\"\n                        label={ this.props.label }\n                        placeholder={ this.props.placeholder }\n                        hint={ this.props.hint }\n                        error={ this.props.error }\n                        resetError={ this.props.resetError }\n                        value={ value }\n                        view={ this.props.view }\n                        width={ this.props.width }\n                        id={ this.props.id }\n                        name={ this.props.name }\n                        leftAddons={ this.props.leftAddons }\n                        rightAddons={ this.props.rightAddons }\n                        onBlur={ this.handleCustomInputBlur }\n                        onChange={ this.handleCustomInputChange }\n                        onFocus={ this.handleCustomInputFocus }\n                        onKeyDown={ this.handleInputKeyDown }\n                        icon={\n                            this.props.withIcon\n                            && (\n                                <IconButton onClick={ this.handleIconButtonClick }>\n                                    <IconCalendar\n                                        size={ this.props.size }\n                                    />\n                                </IconButton>\n                            )\n                        }\n                    />\n                </span>\n                { this.renderPopup(value) }\n            </span>\n        );\n    }\n\n    renderPopup(value) {\n        let opened = this.props.opened === undefined ? this.state.opened : this.props.opened;\n\n        if (this.isSimpleInput()) {\n            opened = false;\n        }\n\n        return (\n            <Popup\n                ref={ (calendarPopup) => {\n                    this.calendarPopup = calendarPopup;\n                } }\n                for={ this.props.name }\n                visible={ opened }\n                directions={ this.props.directions }\n                target={ this.isMobilePopup() ? 'screen' : 'anchor' }\n                header={ this.isMobilePopup() && this.renderMobileHeader() }\n                padded={ false }\n            >\n                <div className={ this.cn('calendar-wrapper', { mobile: this.isMobilePopup() }) }>\n                    <Calendar\n                        ref={ (calendar) => {\n                            this.calendar = calendar;\n                        } }\n                        month={ this.state.month }\n                        { ...this.props.calendar }\n                        value={ parseDate(value, CUSTOM_DATE_FORMAT) }\n                        onBlur={ this.handleCalendarBlur }\n                        onFocus={ this.handleCalendarFocus }\n                        onKeyDown={ this.handleCalendarKeyDown }\n                        onValueChange={ this.handleCalendarChange }\n                        onMonthChange={ this.handleCalendarMonthChange }\n                    />\n                </div>\n            </Popup>\n        );\n    }\n\n    renderMobileHeader() {\n        return (\n            <PopupHeader\n                size={ this.props.size }\n                title={ this.props.mobileTitle || this.props.label || 'Выберите дату' }\n                onCloserClick={ this.handlePopupCloserClick }\n            />\n        );\n    }\n\n    private handleCalendarChange = (value, formatted, isTriggeredByKeyboard) => {\n        if (!isTriggeredByKeyboard) {\n            this.changeCloseTimeoutId = setTimeout(() => {\n                this.calendar.blur(); // FF не испускает событие `blur` когда элементы становятся невидимыми, делаем это явно\n                this.setState({\n                    opened: false,\n                });\n                this.changeCloseTimeoutId = null;\n            }, 0);\n        }\n\n        this.setState({ value: formatted });\n\n        if (this.props.onCalendarChange) {\n            this.props.onCalendarChange(formatted);\n        }\n\n        if (this.props.onChange) {\n            this.props.onChange(formatted, value);\n        }\n    };\n\n    private handleCalendarMonthChange = (month) => {\n        this.setState({\n            month,\n        });\n    };\n\n    private handleCalendarFocus = (event) => {\n        this.changeFocused({ isCalendarFocused: true }, event);\n    };\n\n    private handleCalendarBlur = (event) => {\n        this.changeFocused({ isCalendarFocused: false }, event);\n    };\n\n    private handleCalendarKeyDown = (event) => {\n        switch (event.which) {\n        case keyboardCode.ESCAPE:\n            event.preventDefault();\n            this.customCalendarTarget.focus();\n            break;\n        case keyboardCode.ENTER:\n        case keyboardCode.SPACE:\n            event.preventDefault();\n            this.setState({\n                opened: false,\n            });\n            break;\n        }\n\n        if (this.props.onCalendarKeyDown) {\n            this.props.onCalendarKeyDown(event);\n        }\n\n        if (this.props.onKeyDown) {\n            this.props.onKeyDown(event);\n        }\n    };\n\n    private handleIconButtonClick = () => {\n        this.customCalendarTarget.focus();\n    };\n\n    private handleCustomInputChange = (value) => {\n        const month = calculateMonth(\n            value,\n            CUSTOM_DATE_FORMAT,\n            this.props.calendar ? this.props.calendar.earlierLimit : undefined,\n            this.props.calendar ? this.props.calendar.laterLimit : undefined,\n        );\n\n        this.setState({ value });\n\n        // Изменяет месяц в календаре в соответствии с введёной в поле валидной датой\n        if (value && value.length === CUSTOM_DATE_FORMAT.length && month !== this.state.month) {\n            this.setState({ month });\n        }\n\n        if (this.props.onInputChange) {\n            this.props.onInputChange(value);\n        }\n\n        if (this.props.onChange) {\n            this.props.onChange(value, parseDate(value, CUSTOM_DATE_FORMAT));\n        }\n    };\n\n    private handleNativeInputChange = (event) => {\n        let value = changeDateFormat(event.target.value, NATIVE_DATE_FORMAT, CUSTOM_DATE_FORMAT);\n\n        // Детектим нажатие `сlear` в нативном календаре\n        if (this.state.value === value) {\n            value = '';\n        }\n\n        this.setState({ value });\n\n        if (this.props.onInputChange) {\n            this.props.onInputChange(value);\n        }\n\n        if (this.props.onChange) {\n            this.props.onChange(value, parseDate(value, CUSTOM_DATE_FORMAT));\n        }\n    };\n\n    private handleCustomInputFocus = (event) => {\n        this.changeFocused({ isInputFocused: true }, event);\n\n        if (this.props.onInputFocus) {\n            this.props.onInputFocus(event);\n        }\n    };\n\n    private handleNativeInputFocus = (event) => {\n        // Копируем пришедший из аргументов SyntheticEvent для дальнейшего редактирования\n        const resultEvent = {\n            ...event,\n            // Трансформируем нативную YYYY-MM-DD дату в кастомный формат на вывод в коллбэках\n            target: { value: changeDateFormat(event.target.value, NATIVE_DATE_FORMAT, CUSTOM_DATE_FORMAT) },\n        };\n\n        this.changeFocused({ isInputFocused: true }, resultEvent);\n\n        if (this.props.onInputFocus) {\n            this.props.onInputFocus(resultEvent);\n        }\n    };\n\n    private handleCustomInputBlur = (event) => {\n        this.changeFocused({ isInputFocused: false }, event);\n\n        if (this.props.onInputBlur) {\n            this.props.onInputBlur(event);\n        }\n    };\n\n    private handleNativeInputBlur = (event) => {\n        // Копируем пришедший из аргументов SyntheticEvent для дальнейшего редактирования\n        const resultEvent = {\n            ...event,\n            // Трансформируем нативную YYYY-MM-DD дату в кастомный формат на вывод в коллбэках\n            target: { value: changeDateFormat(event.target.value, NATIVE_DATE_FORMAT, CUSTOM_DATE_FORMAT) },\n        };\n\n        this.changeFocused({ isInputFocused: false }, resultEvent);\n\n        if (this.props.onInputBlur) {\n            this.props.onInputBlur(resultEvent);\n        }\n    };\n\n    private handleInputKeyDown = (event) => {\n        switch (event.which) {\n        case keyboardCode.DOWN_ARROW: {\n            event.preventDefault();\n\n            const value = this.props.value === undefined ? this.state.value : this.props.value;\n\n            this.setState({\n                opened: true,\n                month: calculateMonth(\n                    value,\n                    CUSTOM_DATE_FORMAT,\n                    this.props.calendar ? this.props.calendar.earlierLimit : undefined,\n                    this.props.calendar ? this.props.calendar.laterLimit : undefined,\n                ),\n            });\n\n            this.calendar.focus();\n\n            break;\n        }\n        case keyboardCode.ESCAPE: {\n            event.preventDefault();\n\n            this.setState({\n                opened: false,\n            });\n\n            break;\n        }\n        }\n\n        if (this.props.onInputKeyDown) {\n            this.props.onInputKeyDown(event);\n        }\n\n        if (this.props.onKeyDown) {\n            this.props.onKeyDown(event);\n        }\n    };\n\n    private handleMqMatchChange = (isMatched) => {\n        this.setState({\n            isMobile: isMatched,\n        });\n    };\n\n    private handleMobileWrapperClick = () => {\n        this.setOpened(true);\n    };\n\n    private handlePopupCloserClick = () => {\n        this.setOpened(false);\n    };\n\n    /**\n     * Устанавливает фокус на поле ввода, открывает календарь.\n     */\n    public focus() {\n        const targetRef = this.nativeCalendarTarget || this.customCalendarTarget;\n\n        targetRef.focus();\n    }\n\n    /**\n     * Убирает фокус с поля ввода.\n     */\n    public blur() {\n        const targetRef = this.nativeCalendarTarget || this.customCalendarTarget;\n\n        targetRef.blur();\n    }\n\n    /**\n     * Скроллит страницу до поля ввода.\n     */\n    public scrollTo() {\n        this.customCalendarTarget.scrollTo();\n    }\n\n    private canBeNative() {\n        return SUPPORTS_INPUT_TYPE_DATE && this.props.mobileMode === 'native';\n    }\n\n    private isNativeInput() {\n        return this.state.isMobile && this.canBeNative();\n    }\n\n    private isMobilePopup() {\n        return this.state.isMobile && this.props.mobileMode === 'popup';\n    }\n\n    private isSimpleInput() {\n        return this.state.isMobile && this.props.mobileMode === 'input';\n    }\n\n    private changeFocused(focusedState, event) {\n        const newState = {\n            isInputFocused: this.state.isInputFocused,\n            isCalendarFocused: this.state.isCalendarFocused,\n            ...focusedState,\n        };\n\n        // При переключении фокуса с поля ввода на календарь событие `blur` у поля ввода иногда происходит перед фокусом календаря\n        // Поэтому проверяем элемент который получит фокус после блюра и если он внутри календаря - оставляем сфокусированное состояние.\n        const relatedTarget = event.relatedTarget // не поддерживается в FF и IE10 https://github.com/facebook/react/issues/2011\n            || event.explicitOriginalTarget // не поддерживается в IE\n            || document.activeElement; // В IE вернет не <calendar> а конкретную ноду, на которую пришел фокус\n\n        const calendarWillReceiveFocus = !isNodeOutsideElement(relatedTarget, this.calendar.getNode());\n\n        const newFocused = newState.isInputFocused\n            || newState.isCalendarFocused\n            || calendarWillReceiveFocus;\n\n        this.setState(focusedState);\n\n        let newOpened = false;\n\n        if (newFocused) {\n            if (this.props.onFocus) {\n                this.props.onFocus(event);\n            }\n\n            newOpened = true;\n        } else if (this.props.onBlur) {\n            this.props.onBlur(event);\n        }\n\n        if (!this.isNativeInput()) {\n            this.setOpened(newOpened);\n        }\n    }\n\n    private setOpened(opened) {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n        this.timeoutId = setTimeout(() => {\n            const value = this.props.value === undefined ? this.state.value : this.props.value;\n\n            // eslint-disable-next-line react/no-access-state-in-setstate\n            const newMonth = this.state.opened === opened\n                // eslint-disable-next-line react/no-access-state-in-setstate\n                ? this.state.month\n                : calculateMonth(\n                    value || this.props.defaultMonth,\n                    CUSTOM_DATE_FORMAT,\n                    this.props.calendar ? this.props.calendar.earlierLimit : undefined,\n                    this.props.calendar ? this.props.calendar.laterLimit : undefined,\n                );\n\n            this.setState({\n                opened,\n                month: newMonth,\n            });\n\n            this.timeoutId = null;\n        }, 0);\n    }\n}\n\nexport default withTheme<CalendarInputProps, CalendarInput>(CalendarInput);\n"]}