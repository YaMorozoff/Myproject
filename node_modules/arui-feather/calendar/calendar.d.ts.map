{"version":3,"sources":["calendar/calendar.tsx"],"names":[],"mappings":"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","file":"calendar.d.ts","sourcesContent":["/* eslint-disable jsx-a11y/control-has-associated-label */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n\nimport React from 'react';\n\nimport { createCn } from 'bem-react-classname';\n\nimport differenceInMonths from 'date-fns/difference_in_months';\nimport differenceInMilliseconds from 'date-fns/difference_in_milliseconds';\nimport startOfDay from 'date-fns/start_of_day';\nimport startOfMonth from 'date-fns/start_of_month';\nimport addDays from 'date-fns/add_days';\nimport addYears from 'date-fns/add_years';\nimport subtractYears from 'date-fns/sub_years';\nimport formatDate from 'date-fns/format';\nimport isSameMonth from 'date-fns/is_same_month';\nimport setMonth from 'date-fns/set_month';\nimport setYear from 'date-fns/set_year';\nimport endOfMonth from 'date-fns/end_of_month';\nimport eachDay from 'date-fns/each_day';\nimport sortedIndexOf from 'lodash.sortedindexof';\n\nimport keyboardCode from '../lib/keyboard-code';\nimport performance from '../performance';\nimport { isCurrentDay, getYearsRange } from './utils';\nimport { normalizeDate, getRussianWeekDay } from '../lib/date-utils';\nimport { isNodeOutsideElement } from '../lib/window';\nimport { withTheme } from '../cn';\n\nconst DAYS_IN_WEEK = 7;\nconst EARLY_YEARS_LIMIT = 100;\nconst LATER_YEARS_LIMIT = 1;\nconst TOTAL_WEEK_NUMBER = 6;\nconst SUNDAY_INDEX = 6;\n\nexport type CalendarProps = {\n\n    /**\n     * Выбранная дата, в формате unix timestamp\n     */\n    value?: number;\n\n    /**\n     * Левая граница диапазона дат, в формате unix timestamp\n     */\n    selectedFrom?: number;\n\n    /**\n     * Правая граница диапазона дат, в формате unix timestamp\n     */\n    selectedTo?: number;\n\n    /**\n     * Левая граница дат, возможных для выбора, в формате unix timestamp\n     */\n    earlierLimit?: number;\n\n    /**\n     * Правая граница дат, возможных для выбора, в формате unix timestamp\n     */\n    laterLimit?: number;\n\n    /**\n     * Месяц, в формате unix timestamp\n     */\n    month?: number;\n\n    /**\n     * Обработчик смены даты\n     */\n    onValueChange?: (timestamp?: number, dateString?: string, isTriggeredByKeyboard?: boolean) => void;\n\n    /**\n     * Обработчик смены месяца\n     */\n    onMonthChange?: (month?: number) => void;\n\n    /**\n     * Тип форматирования даты при выводе\n     */\n    outputFormat?: string;\n\n    /**\n     * Список названий месяцев\n     */\n    months?: readonly string[];\n\n    /**\n     * Список названий дней недели\n     */\n    weekdays?: readonly string[];\n\n    /**\n     * Список выходных дней в виде unix timestamp, отсортированный по возрастанию\n     */\n    offDays?: readonly number[];\n\n    /**\n     * Список дней с событиями в виде unix timestamp, отсортированный по возрастанию\n     */\n    eventDays?: readonly number[];\n\n    /**\n     * Отображение текущей даты\n     */\n    showToday?: boolean;\n\n    /**\n     * Отображение стрелок навигации по месяцам\n     */\n    showArrows?: boolean;\n\n    /**\n     * Возможность управления календарём с клавиатуры\n     */\n    isKeyboard?: boolean;\n\n    /**\n     * Управление шириной календаря. При значении 'available' растягивает кнопку на ширину родителя\n     */\n    width?: 'default' | 'available';\n\n    /**\n     * Тема компонента\n     */\n    theme?: 'alfa-on-color' | 'alfa-on-white';\n\n    /**\n     * Дополнительный класс\n     */\n    className?: string;\n\n    /**\n     * Идентификатор компонента в DOM\n     */\n    id?: string;\n\n    /**\n     * Обработчик события нажатия на клавишу клавиатуры в момент, когда фокус находится на компоненте\n     */\n    onKeyDown?: (event?: React.KeyboardEvent<any>) => void;\n\n    /**\n     * Обработчик события отжатия на клавишу клавиатуры в момент, когда фокус находится на компоненте\n     */\n    onKeyUp?: (event?: React.KeyboardEvent<any>) => void;\n\n    /**\n     * Обработчик фокуса\n     */\n    onFocus?: (event?: React.FocusEvent<any>) => void;\n\n    /**\n     * Обработчик снятия фокуса\n     */\n    onBlur?: (event?: React.FocusEvent<any>) => void;\n\n    /**\n     * Идентификатор для систем автоматизированного тестирования\n     */\n    'data-test-id'?: string;\n\n};\n\ntype CalendarState = {\n    isMonthSelection?: boolean;\n    isYearSelection?: boolean;\n    month: Date | number;\n}\n/**\n * Компонент календаря.\n */\n@performance(true)\nexport class Calendar extends React.Component<CalendarProps, CalendarState> {\n    protected cn = createCn('calendar');\n\n    static defaultProps: Partial<CalendarProps> = {\n        selectedFrom: null,\n        selectedTo: null,\n        outputFormat: 'DD.MM.YYYY',\n        weekdays: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],\n        months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',\n            'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\n        offDays: [],\n        eventDays: [],\n        showToday: false,\n        showArrows: true,\n        isKeyboard: true,\n    };\n\n    state: CalendarState = {\n        month: startOfMonth(new Date()),\n    };\n\n    private root: HTMLDivElement;\n\n    private blurTimeoutId: number = null;\n\n    private years = [];\n\n    private earlierLimit: Date;\n\n    private laterLimit: Date;\n\n    private value: Date;\n\n    private selectedTo: Date;\n\n    private selectedFrom: Date;\n\n    // eslint-disable-next-line camelcase\n    UNSAFE_componentWillMount() {\n        this.prepareData();\n    }\n\n    // eslint-disable-next-line camelcase\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        this.prepareData(nextProps);\n    }\n\n    componentWillUnmount() {\n        if (this.blurTimeoutId) {\n            clearTimeout(this.blurTimeoutId);\n            this.blurTimeoutId = null;\n        }\n    }\n\n    render() {\n        return (\n            <div\n                ref={ (root) => {\n                    this.root = root;\n                } }\n                className={ this.cn({ width: this.props.width }) }\n                id={ this.props.id }\n                role=\"grid\"\n                tabIndex={ 0 }\n                onBlur={ this.handleBlur }\n                onFocus={ this.handleFocus }\n                onKeyDown={ this.props.isKeyboard && this.handleKeyDown }\n                onKeyUp={ this.props.isKeyboard && this.handleKeyUp }\n                data-test-id={ this.props['data-test-id'] }\n            >\n                { this.renderTitle() }\n                { this.renderContent() }\n            </div>\n        );\n    }\n\n    renderTitle() {\n        const month = new Date(this.state.month);\n        const isPrevMonthEnabled = !this.earlierLimit\n            || differenceInMonths(month, startOfMonth(this.earlierLimit)) > 0;\n        const isNextMonthEnabled = !this.laterLimit\n            || differenceInMonths(month, this.laterLimit) < 0;\n        const areArrowsVisible = this.props.showArrows\n            && !this.state.isMonthSelection\n            && !this.state.isYearSelection;\n\n        return (\n            <div className={ this.cn('title') }>\n                {\n                    areArrowsVisible && (\n                        <div\n                            className={\n                                this.cn('arrow', {\n                                    direction: 'left',\n                                    disabled: !isPrevMonthEnabled,\n                                })\n                            }\n                            data-step=\"-1\"\n                            data-disabled={ !isPrevMonthEnabled }\n                            role=\"button\"\n                            tabIndex={ 0 }\n                            onClick={ this.handleArrowClick }\n                        />\n                    )\n                }\n                {\n                    areArrowsVisible && (\n                        <div\n                            className={\n                                this.cn('arrow', {\n                                    direction: 'right',\n                                    disabled: !isNextMonthEnabled,\n                                })\n                            }\n                            data-step=\"1\"\n                            data-disabled={ !isNextMonthEnabled }\n                            role=\"button\"\n                            tabIndex={ 0 }\n                            onClick={ this.handleArrowClick }\n                        />\n                    )\n                }\n                <div className={ this.cn('select-buttons') }>\n\n                    <div\n                        className={\n                            this.cn('name', {\n                                month: true,\n                            })\n                        }\n                        role=\"button\"\n                        tabIndex={ 0 }\n                        onClick={ this.handleMonthClick }\n                    >\n                        <div className={ this.cn('select-text') }>\n                            { this.props.months[month.getMonth()] }\n                        </div>\n                        <div className={ this.cn('select-arrows') } />\n                    </div>\n\n                    <div\n                        className={\n                            this.cn('name', {\n                                year: true,\n                            })\n                        }\n                        role=\"button\"\n                        tabIndex={ 0 }\n                        onClick={ this.handleYearClick }\n                    >\n                        <div className={ this.cn('select-text') }>{ `${month.getFullYear()}` }</div>\n                        <div className={ this.cn('select-arrows') } />\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    private handleMonthClick = () => {\n        this.setState({\n            // eslint-disable-next-line react/no-access-state-in-setstate\n            isMonthSelection: !this.state.isMonthSelection,\n            isYearSelection: false,\n        });\n    };\n\n    private handleYearClick = () => {\n        this.setState({\n            isMonthSelection: false,\n            // eslint-disable-next-line react/no-access-state-in-setstate\n            isYearSelection: !this.state.isYearSelection,\n        });\n    };\n\n    renderContent() {\n        return (\n            <React.Fragment>\n                { this.state.isMonthSelection ? this.renderMonths() : null }\n                { this.state.isYearSelection ? this.renderYears() : null }\n                { this.renderDays() }\n            </React.Fragment>\n        );\n    }\n\n    renderMonths() {\n        return (\n            <div className={ this.cn('wrapper') }>\n                <div className={ this.cn('months') }>\n                    {\n                        this.props.months.map((month, index) => {\n                            const monthStart = startOfMonth(setMonth(this.state.month, index));\n                            const monthEnd = endOfMonth(monthStart);\n                            const allMonthDays = eachDay(monthStart, monthEnd);\n                            const off = !allMonthDays.find((day) => this.isValidDate(day));\n                            const selectedDate = new Date(this.state.month);\n                            const isSameMonth = selectedDate\n                                && selectedDate.getMonth() === monthStart.getMonth();\n\n                            const dataMonth = off ? null : monthStart.getTime();\n\n                            const mods = {\n                                type: off ? 'off' : null,\n                                state: isSameMonth ? 'current' : null,\n                            };\n\n                            return (\n                                <div\n                                    className={ this.cn('select', { month: true, ...mods }) }\n                                    key={ `month_${index + 1}` }\n                                    role=\"gridcell\"\n                                    tabIndex={ 0 }\n                                    data-month={ dataMonth }\n                                    onClick={ this.handleSelectMonthClick }\n                                >\n                                    { month }\n                                </div>\n                            );\n                        })\n                    }\n                </div>\n            </div>\n        );\n    }\n\n    private handleSelectMonthClick = (event) => {\n        const newMonth = event.target.attributes['data-month'];\n\n        if (newMonth) {\n            const monthTimestamp = parseInt(newMonth.nodeValue, 10);\n\n            if (this.props.onMonthChange) {\n                this.props.onMonthChange(monthTimestamp);\n            } else {\n                this.setState({\n                    month: monthTimestamp,\n                });\n            }\n\n            this.setState({\n                isMonthSelection: false,\n            });\n\n            this.root.focus();\n        }\n    };\n\n    renderYears() {\n        return (\n            <div className={ this.cn('wrapper') }>\n                <div className={ this.cn('years') }>\n                    {\n                        this.years.map((year, index) => {\n                            const newYear = setYear(this.state.month, year);\n                            const dataYear = newYear.getTime();\n                            const selectedDate = new Date(this.state.month);\n                            const isSameYear = selectedDate\n                                && selectedDate.getFullYear() === newYear.getFullYear();\n\n                            const mods = {\n                                state: isSameYear ? 'current' : null,\n                            };\n\n                            return (\n                                <div\n                                    className={ this.cn('select', { year: true, ...mods }) }\n                                    key={ `year_${index + 1}` }\n                                    role=\"gridcell\"\n                                    tabIndex={ 0 }\n                                    data-year={ dataYear }\n                                    onClick={ this.handleSelectYearClick }\n                                >\n                                    { year }\n                                </div>\n                            );\n                        })\n                    }\n                </div>\n            </div>\n        );\n    }\n\n    private handleSelectYearClick = (event) => {\n        const newYear = event.target.attributes['data-year'];\n\n        if (newYear) {\n            const yearTimestamp = parseInt(newYear.nodeValue, 10);\n\n            if (this.props.onMonthChange) {\n                this.props.onMonthChange(yearTimestamp);\n            } else {\n                this.setState({\n                    month: yearTimestamp,\n                });\n            }\n\n            this.setState({\n                isYearSelection: false,\n            });\n\n            this.root.focus();\n        }\n    };\n\n    renderDays() {\n        const rows = [\n            this.renderShortWeekdays(),\n            ...this.renderMonth(),\n        ];\n\n        return (\n            <table className={ this.cn('layout') }>\n                <tbody>\n                    {\n                        rows.map((row, index) => (\n                            <tr\n                                className={ this.cn('row') }\n                                key={ `row_${index + 1}` }\n                            >\n                                { row }\n                            </tr>\n                        ))\n                    }\n                </tbody>\n            </table>\n        );\n    }\n\n    renderShortWeekdays() {\n        return this.props.weekdays.map((weekdayName, index) => (\n            <th\n                className={ this.cn('dayname', { type: index > 4 ? 'weekend' : false }) }\n                key={ weekdayName }\n            >\n                { weekdayName }\n            </th>\n        ));\n    }\n\n    renderMonth() {\n        return this.calculateWeeks().map((week) => this.renderWeek(week));\n    }\n\n    renderWeek(week) {\n        return week.map((day, index) => {\n            const off = !this.isValidDate(day) || this.isOffDay(day);\n            const event = this.isEventDay(day);\n            const current = isCurrentDay(day);\n            const val = this.value;\n            const weekend = index > 4;\n            const mods: {\n                type?: 'weekend-off' | 'weekend' | 'off';\n                event?: boolean;\n                state?: 'today' | 'current';\n                empty?: boolean;\n            } = {};\n\n            if (day) {\n                const isSameDate = val && val.getTime() === day.getTime();\n                const isBetweenPeriod = this.selectedFrom && this.selectedTo\n                    && this.selectedFrom <= day && this.selectedTo >= day;\n\n                if (off || weekend) {\n                    if (weekend) {\n                        mods.type = off ? 'weekend-off' : 'weekend';\n                    } else {\n                        mods.type = 'off';\n                    }\n                }\n\n                mods.event = event;\n\n                if (current && this.props.showToday) {\n                    mods.state = 'today';\n                }\n\n                if (isSameDate || isBetweenPeriod) {\n                    mods.state = 'current';\n                }\n            } else {\n                mods.empty = true;\n            }\n\n            const dataDay = day && !off\n                ? day.getTime()\n                : null;\n\n            return (\n                <td\n                    key={ day || `day_${index + 1}` }\n                >\n                    <div\n                        className={ this.cn('day', mods) }\n                        role=\"gridcell\"\n                        tabIndex={ 0 }\n                        data-day={ dataDay }\n                        onClick={ this.handleDayClick }\n                    >\n                        { day ? day.getDate() : '' }\n                        { mods.event && (\n                            <span data-day={ dataDay } className={ this.cn('event') } />\n                        ) }\n                    </div>\n                </td>\n            );\n        });\n    }\n\n    private handleDayClick = (event) => {\n        const day = event.target.attributes['data-day'];\n\n        if (day) {\n            this.performChange(parseInt(day.nodeValue, 10));\n        }\n    };\n\n    private handleFocus = (event) => {\n        if (this.blurTimeoutId) {\n            clearTimeout(this.blurTimeoutId);\n            this.blurTimeoutId = null;\n        }\n\n        if (this.props.onFocus) {\n            this.props.onFocus(event);\n        }\n    };\n\n    private handleBlur = (event) => {\n        event.persist();\n        if (this.blurTimeoutId) {\n            clearTimeout(this.blurTimeoutId);\n        }\n\n        this.blurTimeoutId = window.setTimeout(() => {\n            if (isNodeOutsideElement(document.activeElement, this.root) && this.props.onBlur) {\n                this.props.onBlur(event);\n            }\n            this.blurTimeoutId = null;\n        }, 0);\n    };\n\n    private handleArrowClick = (event) => {\n        if (event.currentTarget.attributes['data-disabled'].nodeValue === 'true') {\n            return;\n        }\n\n        const stepSize = event.currentTarget.attributes['data-step'].nodeValue;\n        const step = parseInt(stepSize, 10);\n        const newMonth = new Date(this.state.month);\n\n        newMonth.setMonth(newMonth.getMonth() + step);\n\n        if (this.props.onMonthChange) {\n            this.props.onMonthChange(newMonth.valueOf());\n        } else {\n            this.setState({\n                month: newMonth.valueOf(),\n            });\n        }\n    };\n\n    private handleKeyDown = (event) => {\n        switch (event.which) {\n        case keyboardCode.DOWN_ARROW: {\n            event.preventDefault();\n            this.performChangeWithShift(7, true);\n            break;\n        }\n        case keyboardCode.UP_ARROW:\n            event.preventDefault();\n            this.performChangeWithShift(-7, true);\n            break;\n        case keyboardCode.LEFT_ARROW: {\n            event.preventDefault();\n            this.performChangeWithShift(-1, true);\n            break;\n        }\n        case keyboardCode.RIGHT_ARROW: {\n            event.preventDefault();\n            this.performChangeWithShift(1, true);\n            break;\n        }\n        }\n\n        if (this.props.onKeyDown) {\n            this.props.onKeyDown(event);\n        }\n    };\n\n    private handleKeyUp = (event) => {\n        if (this.props.onKeyUp) {\n            this.props.onKeyUp(event);\n        }\n    };\n\n    /**\n     * Устанавливает фокус на календарь.\n     */\n    public focus() {\n        this.root.focus();\n    }\n\n    /**\n     * Убирает фокус с календаря.\n     */\n    // eslint-disable-next-line class-methods-use-this\n    public blur() {\n        if (document.activeElement) {\n            (document.activeElement as HTMLElement).blur();\n        }\n    }\n\n    /**\n     * Возвращает корневой `HTMLElement` компонента.\n     */\n    public getNode() {\n        return this.root;\n    }\n\n    /**\n     * Возвращает `true`, если переданная дата является валидной и\n     * попадает в заданные лимиты календаря.\n     *\n     * @param value Дата для проверки\n     */\n    private isValidDate(value: Date | number) {\n        if (!value) {\n            return false;\n        }\n\n        /* eslint-disable no-restricted-globals */\n        if (!(value instanceof Date) || !isFinite(value.valueOf())) {\n            return false;\n        }\n        /* eslint-enable no-restricted-globals */\n\n        return !(\n            (this.earlierLimit && this.earlierLimit > value)\n            || (this.laterLimit && this.laterLimit < value)\n        );\n    }\n\n    /**\n     * Возвращает `true`, если переданная дата является выходным днем.\n     *\n     * @param date Дата для проверки\n     */\n    private isOffDay(date: Date | number) {\n        if (this.props.offDays && Array.isArray(this.props.offDays)) {\n            const timestamp = date.valueOf();\n\n            // Поскольку offDays - отсортирован, используем бинарный поиск, O(log n) против O(n) для обычного поиска\n            return sortedIndexOf(this.props.offDays, timestamp) !== -1;\n        }\n\n        return false;\n    }\n\n    /**\n     * Возвращает `true`, если переданная дата является днм с событиями.\n     *\n     * @param date Дата для проверки\n     */\n    private isEventDay(date: Date | number) {\n        if (this.props.eventDays && Array.isArray(this.props.eventDays) && date !== null) {\n            const timestamp = date.valueOf();\n\n            // Поскольку events - отсортирован, используем бинарный поиск, O(log n) против O(n) для обычного поиска\n            return sortedIndexOf(this.props.eventDays, timestamp) !== -1;\n        }\n\n        return false;\n    }\n\n    /**\n     * Генерирует событие, что значие даты изменилось.\n     *\n     * @param timestamp Дата\n     * @param isTriggeredByKeyboard Флаг, что событие\n     * произошло из-за нажатия пользователем кнопки на клавиатуре\n     */\n    private performChange(timestamp: number | Date, isTriggeredByKeyboard = false) {\n        if (!this.props.onValueChange) {\n            return;\n        }\n\n        const date = new Date(timestamp);\n\n        if (!this.isValidDate(date) || this.isOffDay(date)) {\n            return;\n        }\n\n        this.props.onValueChange(\n            timestamp.valueOf(),\n            formatDate(date, this.props.outputFormat),\n            isTriggeredByKeyboard,\n        );\n    }\n\n    /**\n     * Генерирует событие, что значение даты изменилось на переданной число дней.\n     *\n     * @param dayShift Смещение текущей даты в днях.\n     * @param isTriggeredByKeyboard Флаг, что событие\n     * произошло из-за нажатия пользователем кнопки на клавиатуре\n     */\n    private performChangeWithShift(dayShift: number, isTriggeredByKeyboard: boolean) {\n        if (!this.ensureValueInLimits(dayShift)) {\n            return;\n        }\n\n        while (this.isOffDay(addDays(this.value, dayShift))) {\n            dayShift += Math.abs(dayShift) / dayShift;\n        }\n\n        if (this.value) {\n            const shiftedValue = addDays(this.value, dayShift);\n\n            this.performChange(shiftedValue.valueOf(), isTriggeredByKeyboard);\n\n            if (this.props.onMonthChange && !isSameMonth(shiftedValue, this.value)) {\n                this.props.onMonthChange(shiftedValue.valueOf());\n            }\n        } else {\n            this.performChange(this.state.month, true);\n        }\n    }\n\n    private ensureValueInLimits(dayShift) {\n        const shiftedDay = addDays(this.value, dayShift);\n\n        return (!this.earlierLimit || differenceInMilliseconds(shiftedDay, this.earlierLimit) >= 0)\n            && (!this.laterLimit || differenceInMilliseconds(shiftedDay, this.laterLimit) <= 0);\n    }\n\n    private calculateWeeks() {\n        let weekDay: number;\n        let weekCounter = TOTAL_WEEK_NUMBER;\n        const weeks = [];\n        const lastDay = SUNDAY_INDEX;\n        const currentMonth = new Date(this.state.month).getMonth();\n        const dateIterator = new Date(this.state.month);\n\n        // Далее я использую map для обхода массива, но при создании через new Array(DAYS_IN_WEEK);\n        // map не вызывает колбек, для ключей, к которым не были приассигнены значения\n        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\n        // соответственно пропадают undefined значения, поэтому:\n        let week = (new Array(DAYS_IN_WEEK)).fill(null);\n\n        dateIterator.setDate(1);\n\n        while (weekCounter > 0) {\n            weekDay = getRussianWeekDay(dateIterator); // Получаем 0 - пн, 1 - вт, и т.д.\n\n            if (dateIterator.getMonth() === currentMonth) {\n                week[weekDay] = new Date(dateIterator.getTime());\n            }\n\n            if (weekDay === lastDay) {\n                weeks.push(week);\n                weekCounter -= 1;\n                week = (new Array(DAYS_IN_WEEK)).fill(null);\n            }\n\n            dateIterator.setDate(dateIterator.getDate() + 1);\n        }\n\n        if (weekDay !== lastDay) {\n            weeks.push(week);\n        }\n\n        return weeks;\n    }\n\n    private prepareData(nextProps?) {\n        let isInitializing = false;\n\n        if (!nextProps) {\n            nextProps = this.props;\n            isInitializing = true;\n        }\n\n        if (isInitializing || this.props.value !== nextProps.value) {\n            if (nextProps.value) {\n                this.value = startOfDay(normalizeDate(nextProps.value));\n            } else {\n                this.value = null;\n            }\n        }\n\n        let month;\n\n        if (nextProps.month) {\n            month = normalizeDate(nextProps.month);\n        } else if (this.value) {\n            month = new Date(this.value.valueOf());\n        } else {\n            month = new Date();\n        }\n\n        this.setState({\n            month: startOfMonth(month),\n        });\n\n        if (isInitializing || this.props.earlierLimit !== nextProps.earlierLimit) {\n            if (nextProps.earlierLimit) {\n                this.earlierLimit = normalizeDate(nextProps.earlierLimit);\n            } else {\n                this.earlierLimit = subtractYears(new Date(), EARLY_YEARS_LIMIT);\n            }\n\n            this.earlierLimit = startOfDay(this.earlierLimit);\n            if (this.value) {\n                const maxTimestamp = Math.max(\n                    this.value.valueOf(),\n                    this.earlierLimit.valueOf(),\n                );\n\n                this.value = new Date(maxTimestamp);\n            }\n        }\n\n        if (isInitializing || this.props.laterLimit !== nextProps.laterLimit) {\n            if (nextProps.laterLimit) {\n                this.laterLimit = normalizeDate(nextProps.laterLimit);\n            } else {\n                this.laterLimit = addYears(new Date(), LATER_YEARS_LIMIT);\n            }\n\n            this.laterLimit = startOfDay(this.laterLimit);\n            if (this.value) {\n                const minTimestamp = Math.min(\n                    this.value.valueOf(),\n                    this.laterLimit.valueOf(),\n                );\n\n                this.value = new Date(minTimestamp);\n            }\n        }\n\n        this.years = getYearsRange(this.earlierLimit, this.laterLimit);\n\n        if (isInitializing || this.props.selectedTo !== nextProps.selectedTo) {\n            this.selectedTo = nextProps.selectedTo ? normalizeDate(nextProps.selectedTo) : null;\n        }\n\n        if (isInitializing || this.props.selectedFrom !== nextProps.selectedFrom) {\n            this.selectedFrom = nextProps.selectedFrom\n                ? normalizeDate(nextProps.selectedFrom) : null;\n        }\n    }\n}\n\nexport default withTheme<CalendarProps, Calendar>(Calendar);\n"]}