{"version":3,"sources":["sidebar/sidebar.tsx"],"names":[],"mappings":"AAOA,OAAO,KAAK,MAAM,OAAO,CAAC;AA2D1B,oBAAY,YAAY,GAAG;IAEvB;;OAEG;IACH,KAAK,CAAC,EAAE,eAAe,GAAG,eAAe,CAAC;IAE1C;;OAEG;IACH,SAAS,CAAC,EAAE,MAAM,CAAC;IAEnB;;OAEG;IACH,EAAE,CAAC,EAAE,MAAM,CAAC;IAEZ;;OAEG;IACH,QAAQ,CAAC,EAAE,KAAK,CAAC,SAAS,CAAC;IAE3B;;OAEG;IACH,SAAS,CAAC,EAAE,OAAO,CAAC;IAEpB;;OAEG;IACH,UAAU,CAAC,EAAE,OAAO,CAAC;IAErB;;OAEG;IACH,OAAO,EAAE,OAAO,CAAC;IAEjB;;OAEG;IACH,aAAa,CAAC,EAAE,KAAK,CAAC,SAAS,CAAC;IAEhC;;OAEG;IACH,aAAa,CAAC,EAAE,KAAK,CAAC,SAAS,CAAC;IAEhC;;OAEG;IACH,KAAK,CAAC,EAAE,MAAM,CAAC;IAEf;;OAEG;IACH,aAAa,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,aAAa,KAAK,IAAI,CAAC;IAExE;;OAEG;IACH,cAAc,CAAC,EAAE,MAAM,CAAC;CAE3B,CAAC;AAEF,aAAK,YAAY,GAAG;IAChB,QAAQ,EAAE,OAAO,CAAC;CACrB,CAAA;AAED;;GAEG;AACH,qBAAa,OAAQ,SAAQ,KAAK,CAAC,aAAa,CAAC,YAAY,EAAE,YAAY,CAAC;IACxE,SAAS,CAAC,EAAE;;;;;;iBAAuB;IAEnC,MAAM,CAAC,YAAY,EAAE,OAAO,CAAC,YAAY,CAAC,CAIxC;IAEF,KAAK;;MAEH;IAEF,iBAAiB;IAYjB,kBAAkB;IAgBlB,oBAAoB;IAWpB,MAAM;IAuEN,mBAAmB;IAQnB,OAAO,CAAC,mBAAmB,CAEzB;IAEF,OAAO,CAAC,WAAW,CASjB;IAEF,OAAO,CAAC,aAAa,CAOnB;IAEF,OAAO,CAAC,oBAAoB;CAK/B;;AAED,wBAAyD","file":"sidebar.d.ts","sourcesContent":["/* eslint-disable jsx-a11y/control-has-associated-label */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n\nimport React from 'react';\nimport { createCn } from 'bem-react-classname';\nimport { withTheme } from '../cn';\n\nimport IconClose from '../icon/ui/close';\nimport IconButton from '../icon-button';\nimport PopupContainerProvider from '../popup-container-provider/popup-container-provider';\n\nimport keyboardCode from '../lib/keyboard-code';\nimport getScrollbarWidth from '../lib/scrollbar-width';\n\nimport Mq from '../mq';\n\nconst SIDEBAR_WIDTH = 430;\n\nlet savedScrollPosition: number;\n\ntype BodyClassParams = {\n    visible: boolean;\n    hasOverlay: boolean;\n}\n\n/**\n * Восстанавливает исходную позицию скролла\n * после закрытия сайдбара на мобильной версии.\n */\nfunction setCurrentPosition() {\n    document.body.style.top = `-${savedScrollPosition}px`;\n    document.body.scrollTop = savedScrollPosition;\n    document.documentElement.scrollTop = savedScrollPosition;\n}\n\n/**\n * Изменяет класс для body. Нужен для управления скроллом\n * основного экрана при показе сайдбара.\n *\n * @param visible Управление видимостью сайдбара.\n * @param hasOverlay Управление наличием оверлея для сайдбара.\n */\nfunction setBodyClass({ visible, hasOverlay }: BodyClassParams) {\n    document.body.classList[visible ? 'add' : 'remove']('sidebar-visible');\n\n    if (hasOverlay) {\n        document.body.classList[visible ? 'add' : 'remove']('sidebar-overlay');\n    }\n}\n\n/**\n * Обрабатывает событие скролла на body,\n * сохраняя scrollTop для последующего использования в сайдбаре.\n */\nfunction handleBodyScroll() {\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;\n\n    if (scrollTop) {\n        savedScrollPosition = scrollTop;\n    }\n}\n\nexport type SidebarProps = {\n\n    /**\n     * Тема компонента\n     */\n    theme?: 'alfa-on-color' | 'alfa-on-white';\n\n    /**\n     * Дополнительный класс\n     */\n    className?: string;\n\n    /**\n     * Идентификатор компонента в DOM\n     */\n    id?: string;\n\n    /**\n     * Дочерние компоненты\n     */\n    children?: React.ReactNode;\n\n    /**\n     * Признак для отрисовки элемента закрытия\n     */\n    hasCloser?: boolean;\n\n    /**\n     * Признак для отрисовки оверлея\n     */\n    hasOverlay?: boolean;\n\n    /**\n     * Признак появления сайдбара\n     */\n    visible: boolean;\n\n    /**\n     * Контент в шапке сайдбара\n     */\n    headerContent?: React.ReactNode;\n\n    /**\n     * Контент в подвале сайдбара, на мобильных устройствах содержимое футера прижимается к нижней части вьюпорта\n     */\n    footerContent?: React.ReactNode;\n\n    /**\n     * Ширина сайдбара\n     */\n    width?: number;\n\n    /**\n     * Обработчик клика на элемент закрытия\n     */\n    onCloserClick?: (event?: React.MouseEvent<any> | KeyboardEvent) => void;\n\n    /**\n     * Идентификатор для систем автоматизированного тестирования\n     */\n    'data-test-id'?: string;\n\n};\n\ntype SidebarState = {\n    isMobile: boolean;\n}\n\n/**\n * Компонент боковой панели aka холодильник.\n */\nexport class Sidebar extends React.PureComponent<SidebarProps, SidebarState> {\n    protected cn = createCn('sidebar');\n\n    static defaultProps: Partial<SidebarProps> = {\n        hasOverlay: true,\n        hasCloser: true,\n        width: SIDEBAR_WIDTH,\n    };\n\n    state = {\n        isMobile: false,\n    };\n\n    componentDidMount() {\n        this.styleBodyRightMargin();\n\n        setBodyClass({ visible: this.props.visible, hasOverlay: this.props.hasOverlay });\n\n        if (this.props.visible) {\n            window.addEventListener('keydown', this.handleKeyDown);\n        }\n\n        window.addEventListener('scroll', handleBodyScroll);\n    }\n\n    componentDidUpdate() {\n        this.styleBodyRightMargin();\n\n        setBodyClass({ visible: this.props.visible, hasOverlay: this.props.hasOverlay });\n\n        if (this.state.isMobile) {\n            setCurrentPosition();\n        }\n\n        if (this.props.visible) {\n            window.addEventListener('keydown', this.handleKeyDown);\n        } else {\n            window.removeEventListener('keydown', this.handleKeyDown);\n        }\n    }\n\n    componentWillUnmount() {\n        setBodyClass({ visible: false, hasOverlay: this.props.hasOverlay });\n\n        if (this.state.isMobile) {\n            setCurrentPosition();\n        }\n\n        window.removeEventListener('keydown', this.handleKeyDown);\n        window.removeEventListener('scroll', handleBodyScroll);\n    }\n\n    render() {\n        const {\n            hasCloser,\n            children,\n            visible,\n            headerContent,\n            footerContent,\n            hasOverlay,\n            width,\n        } = this.props;\n\n        const offset = visible ? getScrollbarWidth() : 0;\n        const style = { width: this.state.isMobile ? '100%' : `${width + offset}px`, };\n        const contentStyle = { marginRight: this.state.isMobile ? 0 : `-${offset}px`, };\n\n        return (\n            <PopupContainerProvider\n                className={ this.cn({ visible }) }\n                style={ style }\n                data-test-id={ this.props['data-test-id'] }\n            >\n                <div\n                    role=\"button\"\n                    tabIndex={ -1 }\n                    className={ this.cn('overlay', { visible: visible && hasOverlay }) }\n                    onClick={ this.handleClose }\n                />\n                <Mq\n                    query=\"--small-only\"\n                    onMatchChange={ this.handleMqMatchChange }\n                />\n                <div\n                    className={ this.cn('inner') }\n                    id={ this.props.id }\n                >\n                    <header\n                        className={ this.cn('header') }\n                    >\n                        {\n                            hasCloser\n                            && (\n                                <div className={ this.cn('closer') }>\n                                    <IconButton\n                                        size={ this.state.isMobile ? 'm' : 'l' }\n                                        onClick={ this.handleClose }\n                                    >\n                                        <IconClose size=\"l\" />\n                                    </IconButton>\n                                </div>\n                            )\n                        }\n                        {\n                            headerContent\n                                ? this.renderHeaderContent()\n                                : null\n                        }\n                    </header>\n                    <div\n                        style={ contentStyle }\n                        className={ this.cn('content') }\n                    >\n                        { children }\n                    </div>\n                    <footer className={ this.cn('footer') }>\n                        { footerContent }\n                    </footer>\n                </div>\n            </PopupContainerProvider>\n        );\n    }\n\n    renderHeaderContent() {\n        return (\n            <div className={ this.cn('header-content') }>\n                { this.props.headerContent }\n            </div>\n        );\n    }\n\n    private handleMqMatchChange = (isMatched: boolean) => {\n        this.setState({ isMobile: isMatched });\n    };\n\n    private handleClose = (event: React.MouseEvent | KeyboardEvent) => {\n        if (this.props.onCloserClick) {\n            if (this.state.isMobile) {\n                document.body.scrollTop = savedScrollPosition;\n                document.documentElement.scrollTop = savedScrollPosition;\n            }\n\n            this.props.onCloserClick(event);\n        }\n    };\n\n    private handleKeyDown = (event: KeyboardEvent) => {\n        switch (event.which) {\n        case keyboardCode.ESCAPE:\n            event.preventDefault();\n            this.handleClose(event);\n            break;\n        }\n    };\n\n    private styleBodyRightMargin() {\n        const offset = this.props.visible ? getScrollbarWidth() : 0;\n\n        document.body.style.marginRight = !this.state.isMobile && this.props.hasOverlay ? `${offset}px` : '0';\n    }\n}\n\nexport default withTheme<SidebarProps, Sidebar>(Sidebar);\n"]}