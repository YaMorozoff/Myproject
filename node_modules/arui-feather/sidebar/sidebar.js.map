{"version":3,"sources":["sidebar/sidebar.tsx"],"names":[],"mappings":"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","file":"sidebar.js","sourcesContent":["/* eslint-disable jsx-a11y/control-has-associated-label */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n\nimport React from 'react';\nimport { createCn } from 'bem-react-classname';\nimport { withTheme } from '../cn';\n\nimport IconClose from '../icon/ui/close';\nimport IconButton from '../icon-button';\nimport PopupContainerProvider from '../popup-container-provider/popup-container-provider';\n\nimport keyboardCode from '../lib/keyboard-code';\nimport getScrollbarWidth from '../lib/scrollbar-width';\n\nimport Mq from '../mq';\n\nconst SIDEBAR_WIDTH = 430;\n\nlet savedScrollPosition: number;\n\ntype BodyClassParams = {\n    visible: boolean;\n    hasOverlay: boolean;\n}\n\n/**\n * Восстанавливает исходную позицию скролла\n * после закрытия сайдбара на мобильной версии.\n */\nfunction setCurrentPosition() {\n    document.body.style.top = `-${savedScrollPosition}px`;\n    document.body.scrollTop = savedScrollPosition;\n    document.documentElement.scrollTop = savedScrollPosition;\n}\n\n/**\n * Изменяет класс для body. Нужен для управления скроллом\n * основного экрана при показе сайдбара.\n *\n * @param visible Управление видимостью сайдбара.\n * @param hasOverlay Управление наличием оверлея для сайдбара.\n */\nfunction setBodyClass({ visible, hasOverlay }: BodyClassParams) {\n    document.body.classList[visible ? 'add' : 'remove']('sidebar-visible');\n\n    if (hasOverlay) {\n        document.body.classList[visible ? 'add' : 'remove']('sidebar-overlay');\n    }\n}\n\n/**\n * Обрабатывает событие скролла на body,\n * сохраняя scrollTop для последующего использования в сайдбаре.\n */\nfunction handleBodyScroll() {\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;\n\n    if (scrollTop) {\n        savedScrollPosition = scrollTop;\n    }\n}\n\nexport type SidebarProps = {\n\n    /**\n     * Тема компонента\n     */\n    theme?: 'alfa-on-color' | 'alfa-on-white';\n\n    /**\n     * Дополнительный класс\n     */\n    className?: string;\n\n    /**\n     * Идентификатор компонента в DOM\n     */\n    id?: string;\n\n    /**\n     * Дочерние компоненты\n     */\n    children?: React.ReactNode;\n\n    /**\n     * Признак для отрисовки элемента закрытия\n     */\n    hasCloser?: boolean;\n\n    /**\n     * Признак для отрисовки оверлея\n     */\n    hasOverlay?: boolean;\n\n    /**\n     * Признак появления сайдбара\n     */\n    visible: boolean;\n\n    /**\n     * Контент в шапке сайдбара\n     */\n    headerContent?: React.ReactNode;\n\n    /**\n     * Контент в подвале сайдбара, на мобильных устройствах содержимое футера прижимается к нижней части вьюпорта\n     */\n    footerContent?: React.ReactNode;\n\n    /**\n     * Ширина сайдбара\n     */\n    width?: number;\n\n    /**\n     * Обработчик клика на элемент закрытия\n     */\n    onCloserClick?: (event?: React.MouseEvent<any> | KeyboardEvent) => void;\n\n    /**\n     * Идентификатор для систем автоматизированного тестирования\n     */\n    'data-test-id'?: string;\n\n};\n\ntype SidebarState = {\n    isMobile: boolean;\n}\n\n/**\n * Компонент боковой панели aka холодильник.\n */\nexport class Sidebar extends React.PureComponent<SidebarProps, SidebarState> {\n    protected cn = createCn('sidebar');\n\n    static defaultProps: Partial<SidebarProps> = {\n        hasOverlay: true,\n        hasCloser: true,\n        width: SIDEBAR_WIDTH,\n    };\n\n    state = {\n        isMobile: false,\n    };\n\n    componentDidMount() {\n        this.styleBodyRightMargin();\n\n        setBodyClass({ visible: this.props.visible, hasOverlay: this.props.hasOverlay });\n\n        if (this.props.visible) {\n            window.addEventListener('keydown', this.handleKeyDown);\n        }\n\n        window.addEventListener('scroll', handleBodyScroll);\n    }\n\n    componentDidUpdate() {\n        this.styleBodyRightMargin();\n\n        setBodyClass({ visible: this.props.visible, hasOverlay: this.props.hasOverlay });\n\n        if (this.state.isMobile) {\n            setCurrentPosition();\n        }\n\n        if (this.props.visible) {\n            window.addEventListener('keydown', this.handleKeyDown);\n        } else {\n            window.removeEventListener('keydown', this.handleKeyDown);\n        }\n    }\n\n    componentWillUnmount() {\n        setBodyClass({ visible: false, hasOverlay: this.props.hasOverlay });\n\n        if (this.state.isMobile) {\n            setCurrentPosition();\n        }\n\n        window.removeEventListener('keydown', this.handleKeyDown);\n        window.removeEventListener('scroll', handleBodyScroll);\n    }\n\n    render() {\n        const {\n            hasCloser,\n            children,\n            visible,\n            headerContent,\n            footerContent,\n            hasOverlay,\n            width,\n        } = this.props;\n\n        const offset = visible ? getScrollbarWidth() : 0;\n        const style = { width: this.state.isMobile ? '100%' : `${width + offset}px`, };\n        const contentStyle = { marginRight: this.state.isMobile ? 0 : `-${offset}px`, };\n\n        return (\n            <PopupContainerProvider\n                className={ this.cn({ visible }) }\n                style={ style }\n                data-test-id={ this.props['data-test-id'] }\n            >\n                <div\n                    role=\"button\"\n                    tabIndex={ -1 }\n                    className={ this.cn('overlay', { visible: visible && hasOverlay }) }\n                    onClick={ this.handleClose }\n                />\n                <Mq\n                    query=\"--small-only\"\n                    onMatchChange={ this.handleMqMatchChange }\n                />\n                <div\n                    className={ this.cn('inner') }\n                    id={ this.props.id }\n                >\n                    <header\n                        className={ this.cn('header') }\n                    >\n                        {\n                            hasCloser\n                            && (\n                                <div className={ this.cn('closer') }>\n                                    <IconButton\n                                        size={ this.state.isMobile ? 'm' : 'l' }\n                                        onClick={ this.handleClose }\n                                    >\n                                        <IconClose size=\"l\" />\n                                    </IconButton>\n                                </div>\n                            )\n                        }\n                        {\n                            headerContent\n                                ? this.renderHeaderContent()\n                                : null\n                        }\n                    </header>\n                    <div\n                        style={ contentStyle }\n                        className={ this.cn('content') }\n                    >\n                        { children }\n                    </div>\n                    <footer className={ this.cn('footer') }>\n                        { footerContent }\n                    </footer>\n                </div>\n            </PopupContainerProvider>\n        );\n    }\n\n    renderHeaderContent() {\n        return (\n            <div className={ this.cn('header-content') }>\n                { this.props.headerContent }\n            </div>\n        );\n    }\n\n    private handleMqMatchChange = (isMatched: boolean) => {\n        this.setState({ isMobile: isMatched });\n    };\n\n    private handleClose = (event: React.MouseEvent | KeyboardEvent) => {\n        if (this.props.onCloserClick) {\n            if (this.state.isMobile) {\n                document.body.scrollTop = savedScrollPosition;\n                document.documentElement.scrollTop = savedScrollPosition;\n            }\n\n            this.props.onCloserClick(event);\n        }\n    };\n\n    private handleKeyDown = (event: KeyboardEvent) => {\n        switch (event.which) {\n        case keyboardCode.ESCAPE:\n            event.preventDefault();\n            this.handleClose(event);\n            break;\n        }\n    };\n\n    private styleBodyRightMargin() {\n        const offset = this.props.visible ? getScrollbarWidth() : 0;\n\n        document.body.style.marginRight = !this.state.isMobile && this.props.hasOverlay ? `${offset}px` : '0';\n    }\n}\n\nexport default withTheme<SidebarProps, Sidebar>(Sidebar);\n"]}